# ğŸ“Š TINDER AI FEEDBACK PLATFORM - Infrastructure & Relations Diagram

**Generated:** 2025-11-21  
**Version:** 1.1.0

---

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                             â”‚
â”‚                     Port: 3000 (Development)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP REST API
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND API (Express.js)                        â”‚
â”‚                     Port: 5001 (Vercel Lambda)                      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚         â”‚        â”‚          â”‚        â”‚
      â”‚         â”‚        â”‚          â”‚        â”‚
      â–¼         â–¼        â–¼          â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabaseâ”‚ â”‚ AI  â”‚ â”‚ OpenAI â”‚ â”‚ Auth â”‚ â”‚ Storageâ”‚
â”‚PostgreSQLâ”‚ â”‚Gen â”‚ â”‚ GPT-4o â”‚ â”‚ JWT  â”‚ â”‚ Vercel â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â”‚
     â”‚    Replicate/
     â”‚    ByteDance
     â”‚    Seedream-4
     â”‚
[Database Schema]
```

---

## ğŸ—„ï¸ Database Schema (Supabase PostgreSQL)

### ğŸ“‹ Tables & Relations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             USERS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)                                                            â”‚
â”‚     username (TEXT, UNIQUE) â—„â”€â”€â”€ Auth identifier                        â”‚
â”‚     email (TEXT, UNIQUE)                                                 â”‚
â”‚     password_hash (TEXT) â—„â”€â”€â”€â”€â”€â”€ bcrypt hashed                          â”‚
â”‚     full_name (TEXT)                                                     â”‚
â”‚     role (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 'user' | 'admin'                        â”‚
â”‚     is_active (BOOLEAN)                                                  â”‚
â”‚     created_at, updated_at, last_login_at (TIMESTAMPTZ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ 1:N
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PROMPT_TEMPLATES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)                                                            â”‚
â”‚     name (TEXT, UNIQUE) â—„â”€â”€â”€â”€â”€â”€ 'dating_photos_v1'                      â”‚
â”‚     description (TEXT)                                                   â”‚
â”‚     category (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ 'dating', 'nature', etc.                 â”‚
â”‚     base_prompt (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€ Template for generation                 â”‚
â”‚     system_instructions (TEXT) â—„ OpenAI system prompt                   â”‚
â”‚     model (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AI model key                            â”‚
â”‚     model_params (JSONB) â—„â”€â”€â”€â”€â”€ Model configuration                     â”‚
â”‚     version (INTEGER)                                                    â”‚
â”‚     active (BOOLEAN)                                                     â”‚
â”‚     insights_json (JSONB) â—„â”€â”€â”€â”€ { likes: [], dislikes: [] }             â”‚
â”‚     total_uses (INTEGER)                                                 â”‚
â”‚     avg_like_rate (FLOAT)                                                â”‚
â”‚     created_at, updated_at (TIMESTAMPTZ)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ 1:N
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CONTENT                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)                                                            â”‚
â”‚ FK: template_id (UUID) â†’ prompt_templates.id                            â”‚
â”‚ FK: user_id (UUID) â†’ users.id                                           â”‚
â”‚ FK: parent_id (UUID) â†’ content.id (self-reference for variations)       â”‚
â”‚                                                                          â”‚
â”‚     url (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Generated content URL                 â”‚
â”‚     media_type (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 'image' | 'video' | 'audio' | 'text'  â”‚
â”‚                                                                          â”‚
â”‚     â•”â•â•â•â•â•â•â•â•â•â•â• PROMPT CHAIN â•â•â•â•â•â•â•â•â•â•â•â•—                              â”‚
â”‚     â•‘ original_prompt (TEXT)              â•‘ User input                   â”‚
â”‚     â•‘         â†“                          â•‘                              â”‚
â”‚     â•‘ enhanced_prompt (TEXT)              â•‘ OpenAI enhanced              â”‚
â”‚     â•‘         â†“                          â•‘                              â”‚
â”‚     â•‘ final_prompt (TEXT)                 â•‘ Final used prompt            â”‚
â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                              â”‚
â”‚                                                                          â”‚
â”‚     model (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AI model used                         â”‚
â”‚     meta_json (JSONB) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Metadata                              â”‚
â”‚     generation_params (JSONB) â—„â”€â”€â”€ Model params                         â”‚
â”‚                                                                          â”‚
â”‚     â•”â•â•â•â•â•â•â•â•â•â•â• STATISTICS â•â•â•â•â•â•â•â•â•â•â•â•—                                â”‚
â”‚     â•‘ total_ratings (INTEGER)           â•‘                               â”‚
â”‚     â•‘ likes_count (INTEGER)             â•‘ direction = 'right'           â”‚
â”‚     â•‘ dislikes_count (INTEGER)          â•‘ direction = 'left'            â”‚
â”‚     â•‘ superlikes_count (INTEGER)        â•‘ direction = 'up'              â”‚
â”‚     â•‘ like_rate (FLOAT)                 â•‘ Auto-calculated               â”‚
â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚
â”‚                                                                          â”‚
â”‚     created_at (TIMESTAMPTZ)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ 1:N
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            RATINGS                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (UUID)                                                            â”‚
â”‚ FK: content_id (UUID) â†’ content.id [CASCADE DELETE]                     â”‚
â”‚ FK: user_id (UUID) â†’ users.id                                           â”‚
â”‚ UNIQUE: (user_id, content_id) â—„â”€â”€â”€ One rating per user per content      â”‚
â”‚                                                                          â”‚
â”‚     direction (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 'left' | 'right' | 'up' | 'down'     â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                    â”‚ left   = Dislike             â”‚     â”‚
â”‚                                    â”‚ right  = Like                â”‚     â”‚
â”‚                                    â”‚ up     = Superlike           â”‚     â”‚
â”‚                                    â”‚ down   = Skip (can re-rate)  â”‚     â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚     comment (TEXT) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º OpenAI Analysis                     â”‚
â”‚                                     â†“                                    â”‚
â”‚                            Extracts keywords for insights                â”‚
â”‚                                                                          â”‚
â”‚     latency_ms (INTEGER) â—„â”€â”€â”€â”€â”€â”€â”€ User interaction time                 â”‚
â”‚     user_weight (FLOAT) â—„â”€â”€â”€â”€â”€â”€â”€â”€ Rating importance (default 1.0)       â”‚
â”‚     meta_json (JSONB) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Additional metadata                   â”‚
â”‚     created_at (TIMESTAMPTZ)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ N:1 (aggregated)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER_INSIGHTS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: user_id (UUID)                                                       â”‚
â”‚                                                                          â”‚
â”‚     â•”â•â•â•â•â•â•â•â•â•â•â• ANALYZED PATTERNS â•â•â•â•â•â•â•â•â•â•â•â•—                         â”‚
â”‚     â•‘ likes_json (JSONB)                       â•‘                        â”‚
â”‚     â•‘   [{keyword: "Ğ³Ğ°Ñ€Ğ½Ğ° Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", count: 3},â•‘                        â”‚
â”‚     â•‘    {keyword: "Ğ³Ğ°Ñ€Ğ½Ğµ Ğ²Ğ¾Ğ»Ğ¾ÑÑ", count: 2}]  â•‘                        â”‚
â”‚     â•‘                                          â•‘                        â”‚
â”‚     â•‘ dislikes_json (JSONB)                    â•‘                        â”‚
â”‚     â•‘   [{keyword: "Ñ€Ğ¸Ğ¶Ğ¸Ñ…", count: 1},         â•‘                        â”‚
â”‚     â•‘    {keyword: "ÑˆÑ‚ÑƒÑ‡Ğ½Ñ– Ğ¾Ñ‡Ñ–", count: 2}]    â•‘                        â”‚
â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                         â”‚
â”‚                                                                          â”‚
â”‚     â•”â•â•â•â•â•â•â•â•â•â•â• STATISTICS â•â•â•â•â•â•â•â•â•â•â•â•—                                â”‚
â”‚     â•‘ total_swipes (INTEGER)            â•‘ All ratings count             â”‚
â”‚     â•‘ total_likes (INTEGER)             â•‘ right + up count              â”‚
â”‚     â•‘ total_dislikes (INTEGER)          â•‘ left count                    â”‚
â”‚     â•‘ total_superlikes (INTEGER)        â•‘ up count                      â”‚
â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚
â”‚                                                                          â”‚
â”‚     gold_content_ids (UUID[]) â—„â”€â”€â”€â”€ Best content for this user          â”‚
â”‚     preferences_json (JSONB) â—„â”€â”€â”€â”€â”€ { suggestions: [...] }              â”‚
â”‚     last_activity_at (TIMESTAMPTZ)                                      â”‚
â”‚     updated_at (TIMESTAMPTZ)                                            â”‚
â”‚                                                                          â”‚
â”‚     ğŸ”„ UPDATE TRIGGER: Every 10 ratings                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow & Processes

### 1ï¸âƒ£ **Content Generation Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Submit prompt                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Category Detection (OpenAI GPT-4o-mini)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  "Ğ¤Ğ¾Ñ‚Ğ¾ Ğ´Ñ–Ğ²Ñ‡Ğ¸Ğ½Ğ¸ ÑĞºĞ° Ğ¿Ñ€Ğ¸Ğ³Ğ°Ñ” Ñƒ Ğ²Ğ¾Ğ´Ñƒ Ğ² ĞºÑƒĞ¿Ğ°Ğ»ÑŒĞ½Ğ¸ĞºÑƒ"                   â”‚
â”‚ Output: category = "dating"                                              â”‚
â”‚ Duration: ~1200ms                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Fetch User Insights (if userId provided)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Query: user_insights WHERE user_id = ?                                   â”‚
â”‚ Returns:                                                                 â”‚
â”‚   - likes_json: [{keyword, count}, ...]                                 â”‚
â”‚   - dislikes_json: [{keyword, count}, ...]                              â”‚
â”‚   - preferences_json: {suggestions: [...]}                              â”‚
â”‚   - total_swipes, total_likes, etc.                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Build Context                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ context = {                                                              â”‚
â”‚   category: "dating",                                                    â”‚
â”‚   systemInstructions: template.system_instructions,                     â”‚
â”‚   insights: {                                                            â”‚
â”‚     likes: [...templateLikes, ...userLikes],                            â”‚
â”‚     dislikes: [...templateDislikes, ...userDislikes]                    â”‚
â”‚   },                                                                     â”‚
â”‚   variationIndex: 0 (if batch generation)                               â”‚
â”‚ }                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Prompt Enhancement (OpenAI GPT-4o)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ System Prompt:                                                           â”‚
â”‚   "You are an expert prompt engineer specializing in dating photos..."  â”‚
â”‚   - CRITICAL: ONLY ONE PERSON per prompt                                â”‚
â”‚   - Realistic, natural beauty                                           â”‚
â”‚   - Natural lighting, authentic emotions                                â”‚
â”‚                                                                          â”‚
â”‚ User Message:                                                            â”‚
â”‚   Original: "Ğ¤Ğ¾Ñ‚Ğ¾ Ğ´Ñ–Ğ²Ñ‡Ğ¸Ğ½Ğ¸ ÑĞºĞ° Ğ¿Ñ€Ğ¸Ğ³Ğ°Ñ” Ñƒ Ğ²Ğ¾Ğ´Ñƒ Ğ² ĞºÑƒĞ¿Ğ°Ğ»ÑŒĞ½Ğ¸ĞºÑƒ"               â”‚
â”‚   + User preferences (from insights):                                    â”‚
â”‚     Likes: Ğ³Ğ°Ñ€Ğ½Ğ° Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°, Ğ³Ğ°Ñ€Ğ½Ğµ Ğ²Ğ¾Ğ»Ğ¾ÑÑ, ĞµÑÑ‚ĞµÑ‚Ğ¸Ñ‡Ğ½Ğ° Ğ¿Ğ¾Ğ·Ğ°                 â”‚
â”‚     Avoid: Ñ€Ğ¸Ğ¶Ğ¸Ñ…, Ğ½Ğµ Ğ½Ğ°Ñ‚ÑƒÑ€Ğ°Ğ»ÑŒĞ½Ñ– Ğ¾Ñ‡Ñ–                                     â”‚
â”‚                                                                          â”‚
â”‚ Output (Enhanced Prompt):                                                â”‚
â”‚   "Create a realistic image of a young woman in her mid-20s with        â”‚
â”‚    long, wavy brunette hair. She is standing on a beach at sunset...    â”‚
â”‚    wearing a simple, elegant blue bikini... genuine, joyful smile..."   â”‚
â”‚                                                                          â”‚
â”‚ Temperature: 0.7 (single) | 0.9 (variations for diversity)              â”‚
â”‚ Duration: ~3600ms                                                        â”‚
â”‚ Tokens: ~500-700                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: AI Content Generation (Replicate/ByteDance Seedream-4)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input: Enhanced prompt                                                   â”‚
â”‚ Model: bytedance/seedream-4                                              â”‚
â”‚ Parameters: { aspect_ratio, num_inference_steps, etc. }                 â”‚
â”‚                                                                          â”‚
â”‚ Processing: ~30-60 seconds                                               â”‚
â”‚ Output: Image URL (Replicate CDN)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Save to Database (content table)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INSERT INTO content (                                                    â”‚
â”‚   url,                      -- Generated image URL                       â”‚
â”‚   media_type,               -- 'image'                                   â”‚
â”‚   original_prompt,          -- User's input                             â”‚
â”‚   enhanced_prompt,          -- OpenAI enhanced                          â”‚
â”‚   final_prompt,             -- Same as enhanced                         â”‚
â”‚   model,                    -- 'bytedance/seedream-4'                    â”‚
â”‚   template_id,              -- NULL or template UUID                    â”‚
â”‚   user_id,                  -- User UUID                                â”‚
â”‚   parent_id,                -- NULL (first) or parent UUID (variation)  â”‚
â”‚   meta_json                 -- { category, modelKey, variationIndex }   â”‚
â”‚ )                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPONSE: Return content object to frontend                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2ï¸âƒ£ **Rating & Feedback Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Swipe on content                                            â”‚
â”‚   - Left  (Dislike)                                                     â”‚
â”‚   - Right (Like)                                                         â”‚
â”‚   - Up    (Superlike)                                                    â”‚
â”‚   - Down  (Skip - can review again later)                               â”‚
â”‚   + Optional: Comment                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Create Rating (ratings table)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Check: UNIQUE(user_id, content_id)                                       â”‚
â”‚   - If exists & direction='down' â†’ Update rating                         â”‚
â”‚   - If exists & directionâ‰ 'down' â†’ Error (already rated)                â”‚
â”‚   - If not exists â†’ Insert new rating                                    â”‚
â”‚                                                                          â”‚
â”‚ INSERT INTO ratings (                                                    â”‚
â”‚   content_id,                                                            â”‚
â”‚   user_id,                                                               â”‚
â”‚   direction,              -- 'left' | 'right' | 'up' | 'down'           â”‚
â”‚   comment,                -- User's text feedback (optional)             â”‚
â”‚   latency_ms,             -- Time taken to decide                        â”‚
â”‚   user_weight,            -- Rating importance (default 1.0)             â”‚
â”‚   meta_json               -- { content_type, timestamp, etc. }           â”‚
â”‚ )                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Database Trigger - Update Content Statistics                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TRIGGER: update_content_stats() ON INSERT ratings                        â”‚
â”‚                                                                          â”‚
â”‚ UPDATE content SET                                                       â”‚
â”‚   total_ratings = COUNT(*),                                              â”‚
â”‚   likes_count = COUNT(*) WHERE direction='right',                        â”‚
â”‚   dislikes_count = COUNT(*) WHERE direction='left',                      â”‚
â”‚   superlikes_count = COUNT(*) WHERE direction='up',                      â”‚
â”‚   like_rate = (likes + superlikes) / total_ratings                       â”‚
â”‚ WHERE id = content_id                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Check Insights Update Threshold                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IF (total_user_ratings % 10 == 0) THEN                                   â”‚
â”‚   â†’ Trigger insights update (background process)                         â”‚
â”‚ ELSE                                                                     â”‚
â”‚   â†’ Skip insights update                                                 â”‚
â”‚ END                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPONSE: Confirm rating saved                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3ï¸âƒ£ **Insights Update Flow** (Triggered every 10 ratings)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRIGGER: Every 10th rating by user                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Fetch Recent Ratings (last 50)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT direction, comment                                                â”‚
â”‚ FROM ratings                                                             â”‚
â”‚ WHERE user_id = ?                                                        â”‚
â”‚ ORDER BY created_at DESC                                                 â”‚
â”‚ LIMIT 50                                                                 â”‚
â”‚                                                                          â”‚
â”‚ Separate by direction:                                                   â”‚
â”‚   likes = direction IN ('right', 'up')                                   â”‚
â”‚   dislikes = direction = 'left'                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Extract Comments (ONLY rated items with comments)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ likeComments = likes                                                     â”‚
â”‚   .map(r => r.comment)                                                   â”‚
â”‚   .filter(c => c) â—„â”€â”€â”€â”€â”€â”€â”€ âš ï¸ ONLY COMMENTS!                            â”‚
â”‚                                                                          â”‚
â”‚ dislikeComments = dislikes                                               â”‚
â”‚   .map(r => r.comment)                                                   â”‚
â”‚   .filter(c => c) â—„â”€â”€â”€â”€â”€â”€â”€ âš ï¸ ONLY COMMENTS!                            â”‚
â”‚                                                                          â”‚
â”‚ âš ï¸ LIMITATION: Ratings without comments are NOT analyzed!               â”‚
â”‚    - Silent likes â†’ IGNORED                                             â”‚
â”‚    - Silent dislikes â†’ IGNORED                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: OpenAI Comment Analysis (GPT-4o-mini) - TWO CALLS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â• LIKE COMMENTS ANALYSIS â•â•â•â•â•â•â•â•â•â•â•â•—                        â”‚
â”‚ â•‘ Input: All like comments                      â•‘                       â”‚
â”‚ â•‘   ["Ğ³Ğ°Ñ€Ğ½Ğ° Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", "Ğ³Ğ°Ñ€Ğ½Ğµ Ğ²Ğ¾Ğ»Ğ¾ÑÑ", ...]     â•‘                       â”‚
â”‚ â•‘                                               â•‘                       â”‚
â”‚ â•‘ System Prompt:                                â•‘                       â”‚
â”‚ â•‘   "Extract common themes and preferences"     â•‘                       â”‚
â”‚ â•‘                                               â•‘                       â”‚
â”‚ â•‘ Output JSON:                                  â•‘                       â”‚
â”‚ â•‘   {                                           â•‘                       â”‚
â”‚ â•‘     "likes": ["Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", "Ğ²Ğ¾Ğ»Ğ¾ÑÑ", ...],     â•‘                       â”‚
â”‚ â•‘     "dislikes": [],                           â•‘                       â”‚
â”‚ â•‘     "suggestions": ["Add more smiles", ...]   â•‘                       â”‚
â”‚ â•‘   }                                           â•‘                       â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                          â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â• DISLIKE COMMENTS ANALYSIS â•â•â•â•â•â•â•â•â•â•â•â•—                     â”‚
â”‚ â•‘ Input: All dislike comments                      â•‘                    â”‚
â”‚ â•‘   ["Ñ€Ğ¸Ğ¶Ğ¸Ñ…", "Ğ½Ğµ Ğ½Ğ°Ñ‚ÑƒÑ€Ğ°Ğ»ÑŒĞ½Ñ– Ğ¾Ñ‡Ñ–", ...]            â•‘                    â”‚
â”‚ â•‘                                                  â•‘                    â”‚
â”‚ â•‘ Output JSON:                                     â•‘                    â”‚
â”‚ â•‘   {                                              â•‘                    â”‚
â”‚ â•‘     "likes": [],                                 â•‘                    â”‚
â”‚ â•‘     "dislikes": ["Ñ€Ğ¸Ğ¶Ğ¸Ğ¹ ĞºĞ¾Ğ»Ñ–Ñ€", "Ğ»Ñ–Ğ½Ğ·Ğ¸", ...],   â•‘                    â”‚
â”‚ â•‘     "suggestions": ["Avoid red hair", ...]       â•‘                    â”‚
â”‚ â•‘   }                                              â•‘                    â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Count Keywords with Frequency                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function: countKeywords(keywords)                                        â”‚
â”‚                                                                          â”‚
â”‚ Input: ["Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", "Ğ²Ğ¾Ğ»Ğ¾ÑÑ", "Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", "Ğ¿Ğ¾Ğ·Ğ°"]                        â”‚
â”‚                                                                          â”‚
â”‚ Output:                                                                  â”‚
â”‚   [                                                                      â”‚
â”‚     {keyword: "Ğ¿Ğ¾ÑĞ¼Ñ–ÑˆĞºĞ°", count: 2},                                     â”‚
â”‚     {keyword: "Ğ²Ğ¾Ğ»Ğ¾ÑÑ", count: 1},                                       â”‚
â”‚     {keyword: "Ğ¿Ğ¾Ğ·Ğ°", count: 1}                                          â”‚
â”‚   ]                                                                      â”‚
â”‚                                                                          â”‚
â”‚ Sorted by count (descending)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Calculate Statistics                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ totalSwipes = ratings.length                                             â”‚
â”‚ totalLikes = likes.length (right + up)                                   â”‚
â”‚ totalDislikes = dislikes.length (left)                                   â”‚
â”‚ totalSuperlikes = ratings.filter(r => r.direction === 'up').length      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Upsert to user_insights Table                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UPSERT INTO user_insights (                                              â”‚
â”‚   user_id,                                                               â”‚
â”‚   likes_json,           -- [{keyword, count}, ...]                       â”‚
â”‚   dislikes_json,        -- [{keyword, count}, ...]                       â”‚
â”‚   preferences_json,     -- { suggestions: [...] }                        â”‚
â”‚   total_swipes,                                                          â”‚
â”‚   total_likes,                                                           â”‚
â”‚   total_dislikes,                                                        â”‚
â”‚   total_superlikes,                                                      â”‚
â”‚   updated_at            -- NOW()                                         â”‚
â”‚ )                                                                        â”‚
â”‚ ON CONFLICT (user_id) DO UPDATE                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETE: Insights updated and ready for next generation                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— API Routes & Endpoints

### ğŸ“¡ Backend API Structure

```
/api
â”œâ”€â”€ /health â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET    Health check
â”‚
â”œâ”€â”€ /auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Auth routes
â”‚   â”œâ”€â”€ /register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Register new user
â”‚   â”œâ”€â”€ /login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Login user
â”‚   â””â”€â”€ /me â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get current user
â”‚
â”œâ”€â”€ /content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Content management
â”‚   â”œâ”€â”€ /generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Generate new content
â”‚   â”‚                                      Body: {
â”‚   â”‚                                        prompt: string,
â”‚   â”‚                                        userId: UUID,
â”‚   â”‚                                        templateId?: UUID,
â”‚   â”‚                                        contentType: 'image'|'video'|'audio',
â”‚   â”‚                                        modelKey?: string,
â”‚   â”‚                                        count: number (1-10),
â”‚   â”‚                                        customParams?: {}
â”‚   â”‚                                      }
â”‚   â”‚                                      Process:
â”‚   â”‚                                      1. detectCategory(prompt)
â”‚   â”‚                                      2. getUserInsights(userId)
â”‚   â”‚                                      3. enhancePrompt(prompt, context)
â”‚   â”‚                                      4. generateContent(enhancedPrompt)
â”‚   â”‚                                      5. Save to database
â”‚   â”‚
â”‚   â”œâ”€â”€ /:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get content by ID
â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     List content (with filters)
â”‚   â”‚                                      Query: userId, templateId, type,
â”‚   â”‚                                             limit, offset, sortBy, order
â”‚   â””â”€â”€ /random/next â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get random unrated content
â”‚                                          Query: userId, excludeIds
â”‚                                          Logic: Exclude already rated
â”‚                                                 (except direction='down')
â”‚
â”œâ”€â”€ /ratings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Rating management
â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Create new rating
â”‚   â”‚                                      Body: {
â”‚   â”‚                                        contentId: UUID,
â”‚   â”‚                                        userId: UUID,
â”‚   â”‚                                        direction: 'left'|'right'|'up'|'down',
â”‚   â”‚                                        comment?: string,
â”‚   â”‚                                        latencyMs?: number
â”‚   â”‚                                      }
â”‚   â”‚                                      Process:
â”‚   â”‚                                      1. Check if already rated
â”‚   â”‚                                      2. Insert/Update rating
â”‚   â”‚                                      3. Trigger content stats update
â”‚   â”‚                                      4. Check insights update threshold
â”‚   â”‚
â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     List ratings
â”‚   â”‚                                      Query: userId, contentId, direction,
â”‚   â”‚                                             limit
â”‚   â””â”€â”€ /stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get rating statistics
â”‚                                          Query: userId, contentId
â”‚                                          Returns: {
â”‚                                            total, likes, dislikes, superlikes,
â”‚                                            rerolls, likeRate, unrated
â”‚                                          }
â”‚
â”œâ”€â”€ /insights â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Insights management
â”‚   â”œâ”€â”€ /user/:userId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get user insights
â”‚   â”‚                                      Returns: {
â”‚   â”‚                                        likes: string[],
â”‚   â”‚                                        dislikes: string[],
â”‚   â”‚                                        suggestions: string[],
â”‚   â”‚                                        totalSwipes, totalLikes, ...
â”‚   â”‚                                      }
â”‚   â”‚
â”‚   â”œâ”€â”€ /user/:userId/update â”€â”€â”€â”€ POST    Trigger insights update
â”‚   â”‚                                      Process:
â”‚   â”‚                                      1. Fetch last 50 ratings
â”‚   â”‚                                      2. Extract comments
â”‚   â”‚                                      3. Analyze with OpenAI
â”‚   â”‚                                      4. Count keywords
â”‚   â”‚                                      5. Upsert to user_insights
â”‚   â”‚
â”‚   â”œâ”€â”€ /template/:templateId â”€â”€â”€â”€ GET     Get template insights
â”‚   â”œâ”€â”€ /template/:templateId/
â”‚   â”‚   update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Trigger template insights update
â”‚   â”‚
â”‚   â””â”€â”€ /dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get overall analytics
â”‚                                          Returns: {
â”‚                                            totalContent, totalRatings,
â”‚                                            likeRate, topContent, templates
â”‚                                          }
â”‚
â””â”€â”€ /admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Admin routes
    â”œâ”€â”€ /templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     List templates
    â”œâ”€â”€ /templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST    Create template
    â”œâ”€â”€ /templates/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET     Get template
    â”œâ”€â”€ /templates/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PUT     Update template
    â””â”€â”€ /templates/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DELETE  Delete template
```

---

## ğŸ§  AI Services Integration

### 1. **OpenAI Service** (`openai.service.js`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          OPENAI INTEGRATION                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ ğŸ¯ Function: detectCategory(prompt, contentType)                        â”‚
â”‚    Model: GPT-4o-mini                                                    â”‚
â”‚    Purpose: Classify content into categories                            â”‚
â”‚    Categories: dating, nature, architecture, food, technology, art,     â”‚
â”‚                abstract, other                                           â”‚
â”‚    Priority: If mentions person â†’ 'dating'                              â”‚
â”‚    Cost: ~20 tokens per call (~$0.0001)                                 â”‚
â”‚    Duration: ~1200ms                                                     â”‚
â”‚                                                                          â”‚
â”‚ âœ¨ Function: enhancePrompt(originalPrompt, context)                     â”‚
â”‚    Model: GPT-4o                                                         â”‚
â”‚    Purpose: Enhance user prompt with details and preferences            â”‚
â”‚    System Prompt:                                                        â”‚
â”‚      - Dating-specific: Realistic, ONE person, natural beauty           â”‚
â”‚      - General: Detailed, specific, optimized                           â”‚
â”‚    User Message:                                                         â”‚
â”‚      - Original prompt                                                   â”‚
â”‚      - User insights (likes/dislikes)                                    â”‚
â”‚      - Variation index (if batch)                                        â”‚
â”‚    Temperature:                                                          â”‚
â”‚      - 0.7 (single generation)                                           â”‚
â”‚      - 0.9 (batch variations for diversity)                              â”‚
â”‚    Cost: ~500-700 tokens per call (~$0.003)                             â”‚
â”‚    Duration: ~3600ms                                                     â”‚
â”‚                                                                          â”‚
â”‚ ğŸ§  Function: analyzeComments(comments)                                  â”‚
â”‚    Model: GPT-4o-mini                                                    â”‚
â”‚    Purpose: Extract keywords and patterns from user feedback            â”‚
â”‚    Input: Array of comment strings                                      â”‚
â”‚    Output: { likes: [], dislikes: [], suggestions: [] }                 â”‚
â”‚    Format: JSON object with structured data                             â”‚
â”‚    Cost: ~300-500 tokens per call (~$0.0003)                            â”‚
â”‚    Duration: ~2000ms                                                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Replicate Service** (`replicate.service.js`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REPLICATE INTEGRATION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ ğŸ¨ Function: generateContent(prompt, contentType, modelKey, params)     â”‚
â”‚                                                                          â”‚
â”‚    Supported Models:                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ IMAGE MODELS                                             â”‚         â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚    â”‚ â€¢ bytedance/seedream-4 (DEFAULT)                        â”‚         â”‚
â”‚    â”‚   Resolution: 1024x1024                                 â”‚         â”‚
â”‚    â”‚   Inference steps: 20                                   â”‚         â”‚
â”‚    â”‚   Guidance scale: 7.5                                   â”‚         â”‚
â”‚    â”‚   Duration: ~30-60s                                     â”‚         â”‚
â”‚    â”‚                                                         â”‚         â”‚
â”‚    â”‚ â€¢ stability-ai/sdxl                                     â”‚         â”‚
â”‚    â”‚ â€¢ midjourney (via API)                                  â”‚         â”‚
â”‚    â”‚ â€¢ dall-e-3 (via OpenAI)                                 â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                          â”‚
â”‚    Process:                                                              â”‚
â”‚    1. Create prediction with Replicate API                              â”‚
â”‚    2. Poll for completion (max 5 min)                                   â”‚
â”‚    3. Download result to Vercel Blob Storage                            â”‚
â”‚    4. Return public URL                                                  â”‚
â”‚                                                                          â”‚
â”‚    Cost: ~$0.01-0.05 per image (model dependent)                        â”‚
â”‚    Duration: ~30-60 seconds                                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication & Authorization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AUTH SYSTEM (JWT)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Registration Flow:                                                       â”‚
â”‚   1. POST /api/auth/register                                             â”‚
â”‚      Body: { username, email, password, fullName }                      â”‚
â”‚   2. Validate input (unique username/email)                             â”‚
â”‚   3. Hash password with bcrypt (salt rounds: 10)                        â”‚
â”‚   4. Insert into users table                                            â”‚
â”‚   5. Generate JWT token                                                  â”‚
â”‚   6. Return { token, user }                                              â”‚
â”‚                                                                          â”‚
â”‚ Login Flow:                                                              â”‚
â”‚   1. POST /api/auth/login                                                â”‚
â”‚      Body: { username, password }                                       â”‚
â”‚   2. Find user in database                                              â”‚
â”‚   3. Compare password hash with bcrypt                                  â”‚
â”‚   4. Generate JWT token                                                  â”‚
â”‚   5. Update last_login_at                                                â”‚
â”‚   6. Return { token, user }                                              â”‚
â”‚                                                                          â”‚
â”‚ JWT Token Structure:                                                     â”‚
â”‚   {                                                                      â”‚
â”‚     userId: UUID,                                                        â”‚
â”‚     username: string,                                                    â”‚
â”‚     role: 'user' | 'admin',                                              â”‚
â”‚     exp: timestamp                                                       â”‚
â”‚   }                                                                      â”‚
â”‚                                                                          â”‚
â”‚ Protected Routes:                                                        â”‚
â”‚   - Middleware: authMiddleware(req, res, next)                          â”‚
â”‚   - Validates JWT token from Authorization header                       â”‚
â”‚   - Adds user info to req.user                                          â”‚
â”‚   - Blocks unauthorized requests                                        â”‚
â”‚                                                                          â”‚
â”‚ Role-Based Access:                                                       â”‚
â”‚   - USER: Can generate content, rate, view own insights                 â”‚
â”‚   - ADMIN: Full access + template management + dashboard                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Database Triggers & Functions

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTOMATED DATABASE LOGIC                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ 1ï¸âƒ£ TRIGGER: update_content_stats                                        â”‚
â”‚    When: AFTER INSERT ON ratings                                        â”‚
â”‚    Action: Update content statistics automatically                      â”‚
â”‚                                                                          â”‚
â”‚    UPDATE content SET                                                    â”‚
â”‚      total_ratings = (SELECT COUNT(*) FROM ratings WHERE ...),          â”‚
â”‚      likes_count = (SELECT COUNT(*) WHERE direction='right'),           â”‚
â”‚      dislikes_count = (SELECT COUNT(*) WHERE direction='left'),         â”‚
â”‚      superlikes_count = (SELECT COUNT(*) WHERE direction='up'),         â”‚
â”‚      like_rate = (likes + superlikes) / total_ratings                   â”‚
â”‚    WHERE id = NEW.content_id;                                           â”‚
â”‚                                                                          â”‚
â”‚ 2ï¸âƒ£ TRIGGER: trigger_prompt_templates_updated_at                         â”‚
â”‚    When: BEFORE UPDATE ON prompt_templates                              â”‚
â”‚    Action: Set updated_at = NOW()                                       â”‚
â”‚                                                                          â”‚
â”‚ 3ï¸âƒ£ TRIGGER: trigger_user_insights_updated_at                            â”‚
â”‚    When: BEFORE UPDATE ON user_insights                                 â”‚
â”‚    Action: Set updated_at = NOW()                                       â”‚
â”‚                                                                          â”‚
â”‚ 4ï¸âƒ£ TRIGGER: update_users_updated_at                                     â”‚
â”‚    When: BEFORE UPDATE ON users                                         â”‚
â”‚    Action: Set updated_at = NOW()                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VERCEL DEPLOYMENT                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Frontend:                                                                â”‚
â”‚   - Static React build                                                   â”‚
â”‚   - Hosted on Vercel CDN                                                â”‚
â”‚   - Domain: [your-project].vercel.app                                   â”‚
â”‚   - Auto-deploy on git push to main                                     â”‚
â”‚                                                                          â”‚
â”‚ Backend:                                                                 â”‚
â”‚   - Serverless Functions (AWS Lambda)                                   â”‚
â”‚   - Entry point: /backend/src/server.js                                 â”‚
â”‚   - API Route: /api/*                                                    â”‚
â”‚   - vercel.json configuration:                                           â”‚
â”‚     {                                                                    â”‚
â”‚       "rewrites": [                                                      â”‚
â”‚         { "source": "/api/(.*)", "destination": "/backend/src/server" } â”‚
â”‚       ]                                                                  â”‚
â”‚     }                                                                    â”‚
â”‚                                                                          â”‚
â”‚ Environment Variables:                                                   â”‚
â”‚   - SUPABASE_URL                                                         â”‚
â”‚   - SUPABASE_ANON_KEY                                                    â”‚
â”‚   - OPENAI_API_KEY                                                       â”‚
â”‚   - REPLICATE_API_TOKEN                                                  â”‚
â”‚   - JWT_SECRET                                                           â”‚
â”‚   - BLOB_READ_WRITE_TOKEN (Vercel Blob Storage)                         â”‚
â”‚                                                                          â”‚
â”‚ Database:                                                                â”‚
â”‚   - Supabase (PostgreSQL)                                                â”‚
â”‚   - Hosted on Supabase cloud                                            â”‚
â”‚   - Connection pooling enabled                                          â”‚
â”‚                                                                          â”‚
â”‚ Storage:                                                                 â”‚
â”‚   - Vercel Blob Storage                                                  â”‚
â”‚   - For caching AI-generated content                                    â”‚
â”‚   - CDN-backed for fast delivery                                        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Performance Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TYPICAL TIMINGS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Content Generation (Single):                                             â”‚
â”‚   â”œâ”€ Category Detection:          ~1,200ms                              â”‚
â”‚   â”œâ”€ User Insights Fetch:          ~100ms                               â”‚
â”‚   â”œâ”€ Prompt Enhancement:         ~3,600ms                               â”‚
â”‚   â”œâ”€ AI Generation:             ~30,000ms (30s)                         â”‚
â”‚   â””â”€ Database Save:                ~200ms                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   TOTAL:                        ~35,100ms (35s)                         â”‚
â”‚                                                                          â”‚
â”‚ Content Generation (Batch x2):                                           â”‚
â”‚   â”œâ”€ Category Detection:          ~1,200ms                              â”‚
â”‚   â”œâ”€ User Insights Fetch:          ~100ms                               â”‚
â”‚   â”œâ”€ Prompt Enhancement (x2):    ~7,300ms                               â”‚
â”‚   â”œâ”€ AI Generation (parallel):  ~30,000ms (30s)                         â”‚
â”‚   â””â”€ Database Save:                ~300ms                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   TOTAL:                        ~38,900ms (39s)                         â”‚
â”‚                                                                          â”‚
â”‚ Rating Submit:                                                           â”‚
â”‚   â”œâ”€ Validation:                     ~50ms                              â”‚
â”‚   â”œâ”€ Database Insert:               ~150ms                              â”‚
â”‚   â”œâ”€ Content Stats Update:          ~100ms (trigger)                    â”‚
â”‚   â””â”€ Insights Check:                 ~50ms                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   TOTAL:                            ~350ms                              â”‚
â”‚                                                                          â”‚
â”‚ Insights Update (Every 10 ratings):                                      â”‚
â”‚   â”œâ”€ Fetch Ratings:                 ~200ms                              â”‚
â”‚   â”œâ”€ Extract Comments:               ~50ms                              â”‚
â”‚   â”œâ”€ OpenAI Analysis (x2):        ~4,000ms                              â”‚
â”‚   â”œâ”€ Count Keywords:                 ~50ms                              â”‚
â”‚   â””â”€ Database Upsert:               ~150ms                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   TOTAL:                          ~4,450ms (4.5s)                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Cost Estimation (Per 1000 Generations)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COST BREAKDOWN                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ OpenAI API:                                                              â”‚
â”‚   â”œâ”€ Category Detection (GPT-4o-mini):                                  â”‚
â”‚   â”‚   1000 calls Ã— 20 tokens Ã— $0.000150/1K = $0.03                     â”‚
â”‚   â”‚                                                                      â”‚
â”‚   â”œâ”€ Prompt Enhancement (GPT-4o):                                       â”‚
â”‚   â”‚   1000 calls Ã— 650 tokens Ã— $0.00500/1K = $3.25                     â”‚
â”‚   â”‚                                                                      â”‚
â”‚   â””â”€ Comment Analysis (every 10 ratings):                               â”‚
â”‚       100 calls Ã— 400 tokens Ã— $0.000150/1K = $0.006                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   SUBTOTAL:                                 $3.286                      â”‚
â”‚                                                                          â”‚
â”‚ Replicate API (ByteDance Seedream-4):                                   â”‚
â”‚   1000 images Ã— $0.03/image =              $30.00                       â”‚
â”‚                                                                          â”‚
â”‚ Vercel Blob Storage:                                                     â”‚
â”‚   1000 images Ã— 2MB Ã— $0.15/GB =            $0.30                       â”‚
â”‚                                                                          â”‚
â”‚ Supabase Database:                                                       â”‚
â”‚   Free tier: 500MB database, 2GB bandwidth                              â”‚
â”‚   Estimated: $0 (within free tier)                                      â”‚
â”‚                                                                          â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚
â”‚ TOTAL PER 1000 GENERATIONS:                ~$33.59                      â”‚
â”‚ PER GENERATION:                            ~$0.034                      â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Key Technologies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TECHNOLOGY STACK                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Frontend:                                                                â”‚
â”‚   â€¢ React 18.x                                                           â”‚
â”‚   â€¢ React Router v6                                                      â”‚
â”‚   â€¢ Axios (HTTP client)                                                  â”‚
â”‚   â€¢ CSS Modules                                                          â”‚
â”‚                                                                          â”‚
â”‚ Backend:                                                                 â”‚
â”‚   â€¢ Node.js 18.x                                                         â”‚
â”‚   â€¢ Express.js 4.x                                                       â”‚
â”‚   â€¢ @supabase/supabase-js                                                â”‚
â”‚   â€¢ openai (Official SDK)                                                â”‚
â”‚   â€¢ replicate (Official SDK)                                             â”‚
â”‚   â€¢ bcryptjs (Password hashing)                                          â”‚
â”‚   â€¢ jsonwebtoken (JWT auth)                                              â”‚
â”‚                                                                          â”‚
â”‚ Database:                                                                â”‚
â”‚   â€¢ PostgreSQL 15 (via Supabase)                                         â”‚
â”‚   â€¢ JSONB columns for flexible data                                      â”‚
â”‚   â€¢ Triggers & Functions (PL/pgSQL)                                      â”‚
â”‚                                                                          â”‚
â”‚ AI Services:                                                             â”‚
â”‚   â€¢ OpenAI GPT-4o (Prompt enhancement)                                   â”‚
â”‚   â€¢ OpenAI GPT-4o-mini (Category detection, Comment analysis)           â”‚
â”‚   â€¢ Replicate ByteDance Seedream-4 (Image generation)                   â”‚
â”‚                                                                          â”‚
â”‚ Storage:                                                                 â”‚
â”‚   â€¢ Vercel Blob Storage                                                  â”‚
â”‚   â€¢ Replicate CDN (for generated content)                               â”‚
â”‚                                                                          â”‚
â”‚ Deployment:                                                              â”‚
â”‚   â€¢ Vercel (Frontend + Serverless Functions)                            â”‚
â”‚   â€¢ GitHub (Version control)                                            â”‚
â”‚   â€¢ Vercel CLI (Development & deployment)                               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ Current Limitations & Known Issues

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LIMITATIONS & ISSUES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ 1ï¸âƒ£ INSIGHTS ANALYSIS LIMITATION: Only Commented Ratings                 â”‚
â”‚    Current Behavior:                                                     â”‚
â”‚      âœ… User rates with comment â†’ Analyzed by OpenAI                     â”‚
â”‚      âŒ User rates without comment â†’ Ignored completely                  â”‚
â”‚                                                                          â”‚
â”‚    Example Scenario:                                                     â”‚
â”‚      - User has 36 ratings (21 likes, 15 dislikes)                      â”‚
â”‚      - Only 11 have comments (7 likes, 4 dislikes)                      â”‚
â”‚      - Insights based on only 11 ratings (30% of total)                 â”‚
â”‚                                                                          â”‚
â”‚    Impact:                                                               â”‚
â”‚      - "Silent" preferences are not learned                             â”‚
â”‚      - Requires user discipline to add comments                         â”‚
â”‚      - Potentially missing majority of feedback                         â”‚
â”‚                                                                          â”‚
â”‚    Potential Solutions:                                                  â”‚
â”‚      A) Keep as-is (focused quality over quantity)                      â”‚
â”‚      B) Add Vision API analysis for non-commented ratings              â”‚
â”‚      C) Hybrid approach (comments priority + top N visual analysis)     â”‚
â”‚                                                                          â”‚
â”‚ 2ï¸âƒ£ NO REAL-TIME INSIGHTS                                                â”‚
â”‚    - Insights update every 10 ratings only                              â”‚
â”‚    - Manual trigger available via API                                   â”‚
â”‚    - Not reflecting immediate feedback                                  â”‚
â”‚                                                                          â”‚
â”‚ 3ï¸âƒ£ SINGLE LANGUAGE SUPPORT                                              â”‚
â”‚    - Comments in any language (Ukrainian/English/etc.)                  â”‚
â”‚    - Keywords may mix languages                                         â”‚
â”‚    - No translation layer                                               â”‚
â”‚                                                                          â”‚
â”‚ 4ï¸âƒ£ NO USER AUTHENTICATION ON FRONTEND                                   â”‚
â”‚    - Backend has full JWT auth system                                   â”‚
â”‚    - Frontend not yet integrated                                        â”‚
â”‚    - Currently using anonymous userId                                   â”‚
â”‚                                                                          â”‚
â”‚ 5ï¸âƒ£ NO BATCH DOWNLOAD/EXPORT                                             â”‚
â”‚    - Generated content saved in DB                                      â”‚
â”‚    - No bulk export functionality                                       â”‚
â”‚    - No gallery/collection view                                         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Notes & Recommendations

### âœ… What's Working Well:

1. **Prompt Enhancement System** - OpenAI effectively incorporates user insights
2. **Category Detection** - Accurate classification (especially dating content)
3. **Database Triggers** - Automatic statistics updates work perfectly
4. **Variation Generation** - Creates diverse results from same insights
5. **Comment Analysis** - Extracts meaningful keywords from feedback
6. **Comprehensive Logging** - Full transparency of all processes

### ğŸ”„ Recommended Improvements:

1. **Insights Enhancement**:
   - Consider adding Vision API for non-commented ratings
   - Implement confidence scores for insights
   - Add temporal weighting (recent feedback more important)

2. **Frontend Integration**:
   - Implement JWT authentication
   - Add user dashboard with insights visualization
   - Create gallery view for generated content
   - Add export/download functionality

3. **Performance**:
   - Add Redis caching for frequently accessed insights
   - Implement CDN for static assets
   - Optimize database queries with proper indexes

4. **Analytics**:
   - Add detailed analytics dashboard
   - Track conversion rates (swipes â†’ superlikes)
   - Monitor model performance metrics
   - A/B testing for prompt strategies

5. **User Experience**:
   - Real-time insights preview before generation
   - Show why certain prompt enhancements were made
   - Provide feedback on rating quality (encourage comments)

---

## ğŸ¯ Future Features Roadmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FUTURE ENHANCEMENTS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Phase 1: Core Improvements                                               â”‚
â”‚   [ ] Vision API integration for silent ratings                         â”‚
â”‚   [ ] Real-time insights updates (WebSocket)                            â”‚
â”‚   [ ] Frontend authentication integration                               â”‚
â”‚   [ ] User dashboard with analytics                                     â”‚
â”‚   [ ] Batch export functionality                                        â”‚
â”‚                                                                          â”‚
â”‚ Phase 2: Advanced Features                                               â”‚
â”‚   [ ] Multi-language support (translation layer)                        â”‚
â”‚   [ ] A/B testing framework for prompts                                 â”‚
â”‚   [ ] Advanced analytics dashboard                                      â”‚
â”‚   [ ] Content recommendation engine                                     â”‚
â”‚   [ ] Social features (sharing, collections)                            â”‚
â”‚                                                                          â”‚
â”‚ Phase 3: Enterprise Features                                             â”‚
â”‚   [ ] Team collaboration tools                                          â”‚
â”‚   [ ] API rate limiting & quotas                                        â”‚
â”‚   [ ] Custom model training pipeline                                    â”‚
â”‚   [ ] White-label solution                                              â”‚
â”‚   [ ] Audit logs & compliance                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Document Version:** 1.1.0  
**Last Updated:** 2025-11-21  
**Author:** AI Development Team  
**Status:** âœ… Production Ready (with noted limitations)

---

